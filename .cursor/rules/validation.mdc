---
description: This file lists all validation rules for form inputs and business logic in the pastry micro-SaaS, both on the client and server sides. It ensures robust data integrity, security, and user experience consistency across all flows => product purchase, custom request, and admin dashboard interactions.
globs:
alwaysApply: false
---

## üîê Shared Principles

- Validation is duplicated client-side (UX) and server-side (security).
- All schemas should be reusable and DRY-friendly (Zod, Superforms, or equivalent).
- Invalid requests must never reach business logic or Stripe.


## üõí Client Order Flow

### Product Order (`/[slug]/products/[productId]`)

- Client name: required, min 2, max 50 characters  
- Client email: required, valid email format  
- Pickup date:
  - required
  - must not be in the past
  - must respect `product.min_days_notice`
  - must not fall in an unavailable date
- Message: optional, max 500 characters
- Customization form:
  - Required fields must be filled
  - If options include prices ‚Üí validate total price

### Custom Request (`/[slug]/custom`)

- Same as product order for:
  - Name, email, pickup date, message
- All fields defined by the chef‚Äôs custom form must follow:
  - Required: not empty
  - Options: only values defined in `form_fields.options`
  - If option includes price ‚Üí validate total


## üí¨ Quote & Payment Flow (`/[slug]/orders/[orderId]`)

- orderId: must be valid UUID & belong to the current shop
- Action: must be `accept` or `refuse`
- If accepted:
  - Stripe amount = price in DB
  - Order must have `status = quoted`
- If refused:
  - Optional message: max 300 characters



## üßÅ Dashboard (Pastry Chef)

### Shop setup

- Shop name: required, max 50 characters
- Slug: required, only lowercase, hyphens, 3‚Äì20 chars, must be unique
- Bio: optional, max 500 characters
- Logo URL: optional, must be a valid URL
- Stripe account: must be connected (if required)

### Product creation

- Name: required, max 50 characters
- Description: optional, max 1000 characters
- Base price: required, ‚â• 0
- Min days notice: required, integer ‚â• 0
- Image: must be uploaded and under 2MB

### Customization form (per product)

- Each field:
  - Label: required, max 100 characters
  - Type: one of allowed enum
  - Options (JSON): if used, must follow:
    ```json
    [{ "label": "Gold", "price": 5 }]
    ```
    - Each label ‚â§ 50 chars
    - Price ‚â• 0

### Availability

- Days open: boolean per day (0‚Äì6)
- Unavailability periods: start ‚â§ end, cannot overlap


